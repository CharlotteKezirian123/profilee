<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Charlotte Admin Chat</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Roboto',sans-serif; background-color:#e5ddd5; margin:0; display:flex; justify-content:center; align-items:center; height:100vh;}
.container { display:flex; width:95%; max-width:900px; height:85vh; background:#fff; border-radius:20px; box-shadow:0 4px 12px rgba(0,0,0,0.2);}
.user-list { width:200px; border-right:1px solid #ddd; overflow-y:auto; padding:10px;}
.user-item { padding:10px; cursor:pointer; border-radius:10px; margin-bottom:5px; background:#f1f0f0;}
.user-item:hover { background:#ddd; }
.chat-container { flex:1; display:flex; flex-direction:column; border-radius:0 20px 20px 0; overflow:hidden;}
header { background-color:#007aff; color:white; padding:15px; text-align:center; font-size:1.3rem; font-weight:bold;}
#messages { flex:1; overflow-y:auto; padding:15px; display:flex; flex-direction:column; background-color:#e5ddd5;}
.message { position:relative; margin:8px 0; padding:10px 14px; border-radius:20px; max-width:75%; font-size:1rem; line-height:1.4; word-wrap:break-word;}
.sent { align-self:flex-end; background-color:#34c759; color:white; border-bottom-right-radius:5px;}
.received { align-self:flex-start; background-color:#f1f0f0; color:black; border-bottom-left-radius:5px;}
.delete-btn { position:absolute; top:4px; right:6px; background:none; border:none; color:red; font-weight:bold; cursor:pointer; font-size:1rem; display:none;}
.message:hover .delete-btn { display:block; }
#input-container { display:flex; padding:10px; background:#fafafa; border-top:1px solid #ddd;}
#messageInput { flex:1; border:none; border-radius:20px; padding:10px 15px; background:#f1f0f0; font-size:1rem; outline:none;}
button { background-color:#007aff; color:white; border:none; border-radius:50%; width:42px; height:42px; margin-left:10px; cursor:pointer; font-size:1.2rem;}
.login-screen { position:absolute; top:0; left:0; right:0; bottom:0; background-color: rgba(255,255,255,0.98); display:flex; flex-direction:column; justify-content:center; align-items:center;}
.login-screen h2 { color:#007aff; margin-bottom:20px;}
.login-screen input { padding:10px 15px; border-radius:10px; border:1px solid #ccc; font-size:1rem; width:70%; max-width:250px; text-align:center;}
.login-screen button { background-color:#007aff; color:white; border:none; border-radius:10px; padding:10px 20px; margin-top:10px; cursor:pointer; font-size:1rem;}
.login-screen button:hover { background-color:#005fd1;}
</style>
</head>
<body>

<div class="login-screen" id="loginScreen">
  <h2>Admin Login</h2>
  <input type="password" id="passwordInput" placeholder="Enter password..." />
  <button onclick="loginAdmin()">Login</button>
</div>

<div class="container" id="mainContainer" style="display:none;">
  <div class="user-list" id="userList"></div>
  <div class="chat-container">
    <header>üõ†Ô∏è Charlotte's Admin Chat</header>
    <div id="messages"></div>
    <div id="input-container">
      <input type="text" id="messageInput" placeholder="Reply..." disabled>
      <button id="sendBtn" disabled>‚û§</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, onValue, set, remove } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBWThac5V1taUzTshloo1-MbnrB7otwXA0",
  authDomain: "message-chat-bd540.firebaseapp.com",
  databaseURL: "https://message-chat-bd540-default-rtdb.firebaseio.com",
  projectId: "message-chat-bd540",
  storageBucket: "message-chat-bd540.firebasestorage.app",
  messagingSenderId: "1059237610211",
  appId: "1:1059237610211:web:d79dab86c1a07842d97bd6",
  measurementId: "G-9PYTX964RT"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const ADMIN_PASSWORD = "Charlotte123";

const loginScreen = document.getElementById('loginScreen');
const mainContainer = document.getElementById('mainContainer');
const userList = document.getElementById('userList');
const messages = document.getElementById('messages');
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');

let currentUser = null;

window.loginAdmin = function() {
  const entered = document.getElementById('passwordInput').value;
  if (entered === ADMIN_PASSWORD) {
    loginScreen.style.display = 'none';
    mainContainer.style.display = 'flex';
    loadUsers();
  } else {
    alert("Incorrect password!");
  }
}

// Load users
function loadUsers() {
  const usersRef = ref(db, 'messages');
  onValue(usersRef, snapshot => {
    userList.innerHTML = '';
    snapshot.forEach(userSnap => {
      const username = userSnap.key;
      const div = document.createElement('div');
      div.textContent = username;
      div.className = 'user-item';
      div.onclick = () => openChat(username);
      userList.appendChild(div);
    });
  });
}

// Open chat with a user
function openChat(username) {
  currentUser = username;
  messages.innerHTML = '';
  messageInput.disabled = false;
  sendBtn.disabled = false;

  const userRef = ref(db, `messages/${username}`);
  onChildAdded(userRef, snapshot => {
    const msg = snapshot.val();
    const msgKey = snapshot.key;

    const div = document.createElement('div');
    div.className = 'message ' + (msg.name === "Charlotte (Admin)" ? 'sent' : 'received');
    div.textContent = `${msg.name}: ${msg.text}`;

    // Delete button
    const delBtn = document.createElement('button');
    delBtn.textContent = '‚ùå';
    delBtn.className = 'delete-btn';
    delBtn.onclick = () => deleteMessage(username, msgKey);

    div.appendChild(delBtn);
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  });
}

// Delete message from Firebase
function deleteMessage(username, msgKey) {
  if (confirm("Delete this message?")) {
    const msgRef = ref(db, `messages/${username}/${msgKey}`);
    remove(msgRef);
    alert("Message deleted!");
    messages.innerHTML = '';
    openChat(username); // reload messages
  }
}

// Send message
function sendMessage() {
  if (!currentUser) return alert('Select a user first!');
  const text = messageInput.value.trim();
  if (!text) return;

  const msgRef = push(ref(db, `messages/${currentUser}`));
  set(msgRef, {
    name: "Charlotte (Admin)",
    text,
    timestamp: Date.now()
  });

  messageInput.value = '';
}

sendBtn.onclick = sendMessage;
messageInput.addEventListener('keydown', e => { if(e.key==='Enter') sendMessage(); });
</script>

</body>
</html>
