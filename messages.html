<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat with Charlotte</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Roboto',sans-serif; background-color:#e495eb; margin:0; display:flex; justify-content:center; align-items:center; height:100vh;}
.chat-container { width:95%; max-width:600px; height:85vh; background:#fff; display:flex; flex-direction:column; border-radius:20px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.2); position:relative;}
header { background-color:#007aff; color:white; padding:15px; text-align:center; font-size:1.3rem; font-weight:bold;}
#messages { flex:1; overflow-y:auto; padding:15px; display:flex; flex-direction:column; background-color:#e5ddd5;}
.message { margin:8px 0; padding:10px 14px; border-radius:20px; max-width:75%; font-size:1rem; line-height:1.4; word-wrap:break-word;}
.sent { align-self:flex-end; background-color:#007aff; color:white; border-bottom-right-radius:5px;}
.received { align-self:flex-start; background-color:#f1f0f0; color:black; border-bottom-left-radius:5px;}
#input-container { display:flex; padding:10px; background:#fafafa; border-top:1px solid #ddd;}
#messageInput { flex:1; border:none; border-radius:20px; padding:10px 15px; background:#f1f0f0; font-size:1rem; outline:none;}
button { background-color:#007aff; color:white; border:none; border-radius:50%; width:42px; height:42px; margin-left:10px; cursor:pointer; font-size:1.2rem;}
.login-screen { position:absolute; top:0; left:0; right:0; bottom:0; background-color: rgba(255,255,255,0.98); display:flex; flex-direction:column; justify-content:center; align-items:center;}
.login-screen h2 { color:#007aff; margin-bottom:15px; }
.login-screen input { padding:10px 15px; border-radius:10px; border:1px solid #ccc; font-size:1rem; width:70%; max-width:250px; text-align:center; }
.login-screen button { background-color:#007aff; color:white; border:none; border-radius:25px; padding:15px 40px; font-size:1.1rem; font-weight:bold; cursor:pointer; margin-top:15px; transition:background-color 0.2s, transform 0.1s;}
.login-screen button:hover { background-color:#005fce; transform:scale(1.05);}
</style>
</head>
<body>
<div class="chat-container">
  <header>ðŸ’¬ Chat with Charlotte</header>
  <div id="messages"></div>
  <div id="input-container">
    <input type="text" id="messageInput" placeholder="Type your message..." disabled>
    <button id="sendBtn" disabled>âž¤</button>
  </div>
  <div class="login-screen" id="loginScreen">
    <h2>Enter Your Name</h2>
    <input type="text" id="nameInput" placeholder="Your name...">
    <button onclick="login()">Start Chat</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, set } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBWThac5V1taUzTshloo1-MbnrB7otwXA0",
  authDomain: "message-chat-bd540.firebaseapp.com",
  databaseURL: "https://message-chat-bd540-default-rtdb.firebaseio.com",
  projectId: "message-chat-bd540",
  storageBucket: "message-chat-bd540.firebasestorage.app",
  messagingSenderId: "1059237610211",
  appId: "1:1059237610211:web:d79dab86c1a07842d97bd6",
  measurementId: "G-9PYTX964RT"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let username = null;
const loginScreen = document.getElementById('loginScreen');
const messages = document.getElementById('messages');
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');

window.login = function() {
  const name = document.getElementById('nameInput').value.trim();
  if (!name) return alert('Please enter your name.');
  username = name;
  loginScreen.style.display = 'none';
  messageInput.disabled = false;
  sendBtn.disabled = false;
  listenMessages();
}

function sendMessage() {
  const text = messageInput.value.trim();
  if (!text) return;
  const msgRef = push(ref(db, `messages/${username}`)); // user-specific path
  set(msgRef, {
    name: username,
    text,
    timestamp: Date.now()
  });
  messageInput.value = '';
}

function listenMessages() {
  const userRef = ref(db, `messages/${username}`);
  onChildAdded(userRef, snapshot => {
    const msg = snapshot.val();
    const div = document.createElement('div');
    const sender = msg.name === username ? 'You' : msg.name;
    div.className = 'message ' + (msg.name === username ? 'sent' : 'received');
    div.textContent = `${sender}: ${msg.text}`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  });
}

sendBtn.onclick = sendMessage;
messageInput.addEventListener('keydown', e => { if(e.key==='Enter') sendMessage(); });

</script>
</body>
</html>
